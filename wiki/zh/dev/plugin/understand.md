# 基本知识

插件用于为 FlysoftPE 增加新软件, 新功能.

所有插件名称格式必须为 `名称_作者`.

一个插件一般由以下文件和文件夹组成.

| 文件名      | 可选 |
| ----------- | ---- |
| files       | 是   |
| reg_all.reg | 是   |
| main.cmd    | 是   |
| env.cmd     | 是   |
| depend.txt  | 是   |
| package.cmd | 否   |

### 插件加载方式

请转到[转换插件格式](zh/tutorial/convert_plugin).

### 插件加载原理

启动时, FlysoftPE Loader 会先遍历启动盘下的所有插件.

遍历到插件时, 如果是 USB 插件就直接加载, 内存插件就先解压到临时目录.

加载器会先检查插件内是否存在插件信息批处理 `package.cmd`, 如不存在就**终止该插件的加载**.

接着, 加载器会判断插件**是否已经被加载加载过**, 如已经加载则**停止该插件的加载**(**仅对 PE 启动时加载的插件生效, 用户手动加载的插件不受影响**).

加载器会遍历依赖列表文件 `depend.txt` 内的所有依赖并逐个加载, 如果其中一个依赖**不存在**, 就**终止该插件的加载**.

加载完依赖后, 加载器复制 `files` 内的所有内容到内存盘中(`X:`), 并将以 `reg` 开头的注册表文件逐个导入.

这时加载器执行插件初始化批处理 `main.cmd` 并**等待退出**, 然后在**后台启动** `hide.cmd` 帮助插件完成**需要时间长的任务**.

最后, 加载器会**逐行遍历** `env.cmd` **内的内容**并执行, 帮助插件设置可以影响到其他插件的变量(如 `PATH`).
